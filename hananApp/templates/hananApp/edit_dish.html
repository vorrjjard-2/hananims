{% extends 'hananApp/base.html' %}

{% block title %}Edit Dish - Hanan IMS{% endblock %}

{% block content %}
<style>
    .container {
        max-width: 900px;
    }

    .ingredient-select {
        width: 100%;
    }

    .btn-primary {
        background-color: #239D13;
        border-color: #239D13;
    }

    .btn-primary:hover {
        background-color: #1c7c0e;  /* Slightly darker green on hover */
        border-color: #1c7c0e;
    }

    .btn-primary:focus, .btn-primary:active {
        box-shadow: 0 0 0 0.25rem rgba(35, 157, 19, 0.5);  /* Slight green shadow on focus/active */
    }

</style>

<div class="container">
    <h1 class="my-4">Edit Dish: {{ dish.name }}</h1>

    <form method="POST" id="edit-dish-form">
        {% csrf_token %}
        
        <!-- Dish Name -->
        <div class="mb-3">
            <label for="name" class="form-label">Dish Name:</label>
            <input type="text" id="name" name="name" class="form-control" value="{{ dish.name }}" required>
        </div>

        <div class="mb-3">
            <label for="price" class="form-label">Dish Price (PHP):</label>
            <input type="number" id="price" name="price" class="form-control" value="{{ dish.price }}" step="0.01" min="0" required>
        </div>

        <h2 class="my-4">Ingredients</h2>

        <table id="ingredients-table" class="table table-bordered">
            <thead>
                <tr>
                    <th>Ingredient</th>
                    <th>Quantity</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for recipe in dish.recipedetails_set.all %}
                <tr>
                    <td>
                        <select class="ingredient-select form-control" name="ingredient_{{ forloop.counter }}" required>
                            {% for ingredient in ingredients %}
                                <option value="{{ ingredient.id }}" {% if recipe.ingredient.id == ingredient.id %}selected{% endif %}>{{ ingredient.name }}</option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <input type="number" name="quantity_{{ forloop.counter }}" class="form-control" value="{{ recipe.quantity_used }}" min="1" required>
                    </td>
                    <td>
                        <button type="button" class="btn btn-danger remove-row">Remove</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <button type="button" class="btn btn-success" id="add-ingredient-row">Add Ingredient</button>

        <button type="submit" class="btn btn-primary mt-3">Save Changes</button>
    </form>
</div>

<script>
    // Add new row for ingredients
    document.getElementById('add-ingredient-row').addEventListener('click', function () {
        const tbody = document.querySelector('#ingredients-table tbody');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <select class="ingredient-select form-control" name="ingredient_${tbody.children.length + 1}" required>
                    {% for ingredient in ingredients %}
                        <option value="{{ ingredient.id }}">{{ ingredient.name }}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <input type="number" name="quantity_${tbody.children.length + 1}" class="form-control" min="1" required>
            </td>
            <td>
                <button type="button" class="btn btn-danger remove-row">Remove</button>
            </td>
        `;
        tbody.appendChild(row);
    });

    // Remove ingredient row
    document.addEventListener('click', function (e) {
        if (e.target && e.target.classList.contains('remove-row')) {
            e.target.closest('tr').remove();
        }
    });
</script>

{% endblock %}
